#!/usr/bin/env bash

# ~/.macos — https://mths.be/macos
# Inspiration: https://github.com/kentcdodds/dotfiles/blob/master/.macos
# Modified by Gordy
# Run without downloading:
# curl https://raw.githubusercontent.com/gortron/dotfiles/master/.macos | bash

# Dock: Brave Notion Things Messages Whatsapp Slack Discord Spotify VSCode iTerm ActivityMonitor SysPref
# Menu Bar: Focus Clipy Amphetamine Alfred Magnets BT Proton WiFi Sounds Battery ItsyCal(date) Time

# Close any open System Preferences panes, to prevent them from overriding
# settings we’re about to change
osascript -e 'tell application "System Preferences" to quit'

# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.macos` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

###############################################################################
# Gordy's Customizations                                                      #
###############################################################################

echo "Hello $(whoami)! Let's get you set up."

echo "mkdir -p ${HOME}/Development"
mkdir -p "${HOME}/Development"

echo "installing homebrew"
# install homebrew https://brew.sh
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)" 

# apps
echo "installing apps from cask"
brew install --cask alfred discord slack whatsapp brave-browser google-chrome firefox bettertouchtool dozer itsycal spotify the-unarchiver zoomus protonvpn clipy notion wireshark microsoft-office

# mas for => magnets bear things 1password
echo "installing apps from App Store"
brew install mas
mas install 937984704 1091189122 904280696 1333542190

# code
echo "installing dev tooling"
brew install git gh postgresql awscli
brew install --cask visual-studio-code iterm2 postman postico pgadmin4 docker dash


# nvm, node, yarn
echo "Installing nvm, node, and yarn"
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.36.0/install.sh | bash
export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" # This loads nvm
nvm install node
brew install yarn

# python
brew install pyenv
pyenv install 3.8.5
brew install pipenv

# git
echo "Generating an RSA token for GitHub"
mkdir -p ~/.ssh
touch ~/.ssh/config
ssh-keygen -t rsa -b 4096 -C "gordon.lanza@gmail.com"
echo "Host *\n AddKeysToAgent yes\n UseKeychain yes\n IdentityFile ~/.ssh/id_rsa" | tee ~/.ssh/config
eval "$(ssh-agent -s)"
echo "run 'pbcopy < ~/.ssh/id_rsa.pub' and paste that into GitHub"

# vscode
# Nothing, it's handled with settings sync

# zsh
sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
brew install zsh-syntax-highlighting zsh-autosuggestions

# Disable the “Are you sure you want to open this application?” dialog
sudo defaults write com.apple.LaunchServices LSQuarantine -bool false

# TODO: touchbar settings