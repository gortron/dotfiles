#!/usr/bin/env bash

# Run without downloading:
# curl https://raw.githubusercontent.com/gortron/dotfiles/master/.macos | bash

# Close any open System Preferences panes, to prevent them from overriding
# settings we’re about to change
osascript -e 'tell application "System Preferences" to quit'

# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.macos` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

echo "Hello $(whoami)! Let's get you set up."

echo "mkdir -p ${HOME}/Development"
mkdir -p "${HOME}/Development"

echo "installing homebrew"
# install homebrew https://brew.sh
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"

# essential apps
echo "installing essential apps from cask"
brew install --cask raycast bitwarden tailscale-app brave-browser google-chrome firefox bartender itsycal spotify the-unarchiver appcleaner  obsidian notion cleanshot syncthing discord element little-snitch anki balenaetcher istat-menus@6

# mas for => amphetamine magnet things pixelmator-pro
echo "installing apps from App Store"
brew install mas
mas install 937984704 441258766 904280696 1289583905

# code
echo "installing dev tooling"
brew install git gh ripgrep fd fzf bat eza jq yq tree delta lazygit zoxide tldr uv
brew install --cask visual-studio-code ghostty orbstack claude-code

echo "installing nvm and node latest"
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" # This loads nvm
nvm install node

# Disable the “Are you sure you want to open this application?” dialog
sudo defaults write com.apple.LaunchServices LSQuarantine -bool false
